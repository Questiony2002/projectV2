<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800" height="700" version="1.1">
  <title>AI心理咨询功能时序图</title>
  
  <!-- 参与者标题 -->
  <rect x="50" y="30" width="100" height="40" rx="5" ry="5" fill="white" stroke="black" stroke-width="2" />
  <text x="84" y="55" font-size="14" text-anchor="middle">用户</text>
  
  <rect x="200" y="30" width="100" height="40" rx="5" ry="5" fill="white" stroke="black" stroke-width="2" />
  <text x="250" y="55" font-size="14" text-anchor="middle">客户端</text>
  
  <rect x="350" y="30" width="100" height="40" rx="5" ry="5" fill="white" stroke="black" stroke-width="2" />
  <text x="400" y="55" font-size="14" text-anchor="middle">咨询控制器</text>
  
  <rect x="500" y="30" width="100" height="40" rx="5" ry="5" fill="white" stroke="black" stroke-width="2" />
  <text x="550" y="55" font-size="14" text-anchor="middle">AI引擎</text>
  
  <rect x="650" y="30" width="100" height="40" rx="5" ry="5" fill="white" stroke="black" stroke-width="2" />
  <text x="700" y="55" font-size="14" text-anchor="middle">数据库</text>
  
  <!-- 生命线 -->
  <line x1="100" y1="70" x2="100" y2="680" stroke="black" stroke-width="1" stroke-dasharray="5,5" />
  <line x1="250" y1="70" x2="250" y2="680" stroke="black" stroke-width="1" stroke-dasharray="5,5" />
  <line x1="400" y1="70" x2="400" y2="680" stroke="black" stroke-width="1" stroke-dasharray="5,5" />
  <line x1="550" y1="70" x2="550" y2="680" stroke="black" stroke-width="1" stroke-dasharray="5,5" />
  <line x1="700" y1="70" x2="700" y2="680" stroke="black" stroke-width="1" stroke-dasharray="5,5" />
  
  <!-- AI心理咨询流程 -->
  <text x="30" y="100" font-size="14">AI心理咨询流程:</text>
  
  <!-- 1. 用户开始咨询会话 -->
  <line x1="100" y1="120" x2="250" y2="120" stroke="black" stroke-width="2" />
  <polygon points="245,115 250,120 245,125" fill="black" />
  <text x="130" y="115" font-size="12">1: 点击开始咨询</text>
  
  <!-- 激活客户端 -->
  <rect x="245" y="120" width="10" height="540" fill="white" stroke="black" stroke-width="1" />
  
  <!-- 2. 客户端验证用户登录状态 -->
  <line x1="255" y1="140" x2="275" y2="140" stroke="black" stroke-width="2" />
  <line x1="275" y1="140" x2="275" y2="160" stroke="black" stroke-width="2" />
  <line x1="275" y1="160" x2="255" y2="160" stroke="black" stroke-width="2" />
  <polygon points="260,155 255,160 260,165" fill="black" />
  <text x="285" y="150" font-size="12">2: 验证登录状态</text>
  
  <!-- 3. 请求新建咨询会话 -->
  <line x1="255" y1="180" x2="400" y2="180" stroke="black" stroke-width="2" />
  <polygon points="395,175 400,180 395,185" fill="black" />
  <text x="290" y="175" font-size="12">3: 创建咨询会话</text>
  
  <!-- 激活咨询控制器 -->
  <rect x="395" y="180" width="10" height="480" fill="white" stroke="black" stroke-width="1" />
  
  <!-- 4. 获取用户历史记录 -->
  <line x1="405" y1="200" x2="700" y2="200" stroke="black" stroke-width="2" />
  <polygon points="695,195 700,200 695,205" fill="black" />
  <text x="490" y="195" font-size="12">4: 获取用户历史咨询记录</text>
  
  <!-- 激活数据库 -->
  <rect x="695" y="200" width="10" height="40" fill="white" stroke="black" stroke-width="1" />
  
  <!-- 5. 返回历史记录 -->
  <line x1="695" y1="240" x2="405" y2="240" stroke="black" stroke-width="2" />
  <polygon points="410,235 405,240 410,245" fill="black" />
  <text x="490" y="235" font-size="12">5: 返回历史记录</text>
  
  <!-- 6. 创建AI会话 -->
  <line x1="405" y1="260" x2="550" y2="260" stroke="black" stroke-width="2" />
  <polygon points="545,255 550,260 545,265" fill="black" />
  <text x="420" y="255" font-size="12">6: 初始化AI引擎会话</text>
  
  <!-- 激活AI引擎 -->
  <rect x="545" y="260" width="10" height="380" fill="white" stroke="black" stroke-width="1" />
  
  <!-- 7. 加载用户心理模型 -->
  <line x1="555" y1="280" x2="700" y2="280" stroke="black" stroke-width="2" />
  <polygon points="695,275 700,280 695,285" fill="black" />
  <text x="570" y="275" font-size="12">7: 加载用户心理模型</text>
  
  <!-- 激活数据库 -->
  <rect x="695" y="280" width="10" height="40" fill="white" stroke="black" stroke-width="1" />
  
  <!-- 8. 返回心理模型 -->
  <line x1="695" y1="320" x2="555" y2="320" stroke="black" stroke-width="2" />
  <polygon points="560,315 555,320 560,325" fill="black" />
  <text x="580" y="315" font-size="12">8: 返回用户心理模型</text>
  
  <!-- 9. 返回会话ID -->
  <line x1="545" y1="340" x2="405" y2="340" stroke="black" stroke-width="2" />
  <polygon points="410,335 405,340 410,345" fill="black" />
  <text x="430" y="335" font-size="12">9: 返回会话ID</text>
  
  <!-- 10. 返回会话信息 -->
  <line x1="395" y1="360" x2="255" y2="360" stroke="black" stroke-width="2" />
  <polygon points="260,355 255,360 260,365" fill="black" />
  <text x="280" y="355" font-size="12">10: 返回会话信息</text>
  
  <!-- 11. 显示咨询界面 -->
  <line x1="245" y1="380" x2="100" y2="380" stroke="black" stroke-width="2" />
  <polygon points="105,375 100,380 105,385" fill="black" />
  <text x="130" y="375" font-size="12">11: 显示咨询界面</text>
  
  <!-- 12. 用户发送咨询信息 -->
  <line x1="100" y1="420" x2="250" y2="420" stroke="black" stroke-width="2" />
  <polygon points="245,415 250,420 245,425" fill="black" />
  <text x="130" y="415" font-size="12">12: 发送咨询内容</text>
  
  <!-- 13. 转发咨询信息 -->
  <line x1="255" y1="440" x2="400" y2="440" stroke="black" stroke-width="2" />
  <polygon points="395,435 400,440 395,445" fill="black" />
  <text x="290" y="435" font-size="12">13: 转发咨询内容</text>
  
  <!-- 14. 存储用户消息 -->
  <line x1="405" y1="460" x2="700" y2="460" stroke="black" stroke-width="2" />
  <polygon points="695,455 700,460 695,465" fill="black" />
  <text x="450" y="455" font-size="12">14: 存储用户消息</text>
  
  <!-- 激活数据库 -->
  <rect x="695" y="460" width="10" height="40" fill="white" stroke="black" stroke-width="1" />
  
  <!-- 15. 确认存储成功 -->
  <line x1="695" y1="500" x2="405" y2="500" stroke="black" stroke-width="2" />
  <polygon points="410,495 405,500 410,505" fill="black" />
  <text x="520" y="495" font-size="12">15: 确认存储成功</text>
  
  <!-- 16. 发送消息给AI -->
  <line x1="405" y1="520" x2="550" y2="520" stroke="black" stroke-width="2" />
  <polygon points="545,515 550,520 545,525" fill="black" />
  <text x="420" y="515" font-size="12">16: 发送消息给AI处理</text>
  
  <!-- 17. AI分析并生成回复 -->
  <line x1="555" y1="540" x2="575" y2="540" stroke="black" stroke-width="2" />
  <line x1="575" y1="540" x2="575" y2="560" stroke="black" stroke-width="2" />
  <line x1="575" y1="560" x2="555" y2="560" stroke="black" stroke-width="2" />
  <polygon points="560,555 555,560 560,565" fill="black" />
  <text x="585" y="550" font-size="12">17: 分析情感并生成回复</text>
  
  <!-- 18. 返回AI回复 -->
  <line x1="545" y1="580" x2="405" y2="580" stroke="black" stroke-width="2" />
  <polygon points="410,575 405,580 410,585" fill="black" />
  <text x="420" y="575" font-size="12">18: 返回AI回复内容</text>
  
  <!-- 19. 存储AI回复 -->
  <line x1="405" y1="600" x2="700" y2="600" stroke="black" stroke-width="2" />
  <polygon points="695,595 700,600 695,605" fill="black" />
  <text x="450" y="595" font-size="12">19: 存储AI回复内容</text>
  
  <!-- 激活数据库 -->
  <rect x="695" y="600" width="10" height="40" fill="white" stroke="black" stroke-width="1" />
  
  <!-- 20. 确认存储成功 -->
  <line x1="695" y1="640" x2="405" y2="640" stroke="black" stroke-width="2" />
  <polygon points="410,635 405,640 410,645" fill="black" />
  <text x="520" y="635" font-size="12">20: 确认存储成功</text>
  
  <!-- 21. 转发AI回复 -->
  <line x1="395" y1="660" x2="255" y2="660" stroke="black" stroke-width="2" />
  <polygon points="260,655 255,660 260,665" fill="black" />
  <text x="280" y="655" font-size="12">21: 转发AI回复内容</text>
  
  <!-- 22. 显示AI回复 -->
  <line x1="245" y1="680" x2="100" y2="680" stroke="black" stroke-width="2" />
  <polygon points="105,675 100,680 105,685" fill="black" />
  <text x="130" y="675" font-size="12">22: 显示AI回复内容</text>
</svg>